<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Booking Confirm</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

</head>

<body th:fragment="manageroom" class="bg-gray-100 p-6">

    <h1 class="text-2xl font-bold mb-6">Manage Room</h1>

    <table class="min-w-full bg-white rounded shadow">
        <thead class="bg-gray-200">
            <tr>
                <th class="border border-gray-300 px-4 py-2">Manage ID</th>
                <th class="border border-gray-300 px-4 py-2">Create At</th>
                <th class="border border-gray-300 px-4 py-2">Start Date</th>
                <th class="border border-gray-300 px-4 py-2">End Date</th>
                <th class="border border-gray-300 px-4 py-2">Note</th>
                <th class="border border-gray-300 px-4 py-2">Status</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="m : ${managerooms}" class="border-b">
                <td class="px-4 py-2" th:text="${m.manageRoomId}"></td>
                <td class="px-4 py-2" th:text="${#temporals.format(m.createAt, 'dd-MM-yyyy HH:mm')}"></td>
                <td class="px-4 py-2" th:text="${#temporals.format(m.startDate, 'dd-MM-yyyy')}"></td>
                <td class="px-4 py-2" th:text="${#temporals.format(m.endDate, 'dd-MM-yyyy')}"></td>
                <td class="px-4 py-2" th:text="${m.note != null ? m.note : 'N/A'}"></td>
                <td class="px-4 py-2">
                    <select th:id="'status-' + ${m.manageRoomId}"
                        th:onchange="'changeManageRoomStatus(' + ${m.manageRoomId} + ', this.value)'"
                        class="border rounded px-2 py-1">
                        <option value="CLEANING" th:selected="${m.status.name() == 'CLEANING'}">CLEANING</option>
                        <option value="MAINTAINCE" th:selected="${m.status.name() == 'MAINTAINCE'}">MAINTAINCE</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
    <script>
        async function changeManageRoomStatus(manageRoomId, status) {
            const body = { status: status };
            console.log("Sending body:", body);

            try {
                 const response = await fetch(`/api/manage-rooms/update/${manageRoomId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    location.reload();
                } else {
                    const err = await response.text();
                    alert("Cập nhật thất bại: " + err);
                }
            } catch (error) {
                console.error(error);
                alert("Lỗi khi gửi request");
            }
        }
    </script>


</body>

</html>