<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Ch·ªânh s·ª≠a ph√≤ng</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <!-- Th√™m CKEditor 5 CDN -->
    <script src="https://cdn.ckeditor.com/ckeditor5/41.3.1/classic/ckeditor.js"></script>
</head>

<body class="bg-gray-100 p-6">

<div class="max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold mb-6 text-center text-blue-600">üõèÔ∏è Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</h1>

    <div class="grid grid-cols-2 gap-4" th:object="${room}">

        <!-- T√™n ph√≤ng -->
        <div class="col-span-2">
            <label class="block font-semibold mb-1 text-gray-700">T√™n ph√≤ng</label>
            <input id="roomName" type="text" name="roomName" th:value="*{roomName}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- Lo·∫°i ph√≤ng -->
        <div>
            <label class="block font-semibold mb-1 text-gray-700">Lo·∫°i ph√≤ng</label>
            <input id="roomType" type="text" name="type" th:value="*{type}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- Gi√° -->
        <div>
            <label class="block font-semibold mb-1 text-gray-700">Gi√° (VNƒê)</label>
            <input id="price" type="number" step="0.01" name="price" th:value="*{price}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- M√¥ t·∫£ (CKEditor thay th·∫ø textarea) -->
        <div class="col-span-2">
            <label class="block font-semibold mb-1 text-gray-700">M√¥ t·∫£</label>
            <textarea id="description" name="description" th:text="*{description}"
                      class="w-full border rounded p-2 focus:ring focus:ring-blue-300"
                      placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ ph√≤ng..."></textarea>
        </div>

        <!-- ·∫¢nh -->
        <div class="col-span-2">
            <label class="block font-semibold mb-1 text-gray-700">·∫¢nh (URL)</label>
            <input id="img" type="text" name="img" th:value="*{img}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" placeholder="https://...">
            <div class="mt-3 flex justify-center">
                <img th:src="*{img}" alt="Room Image Preview"
                     class="w-64 h-40 object-cover rounded-lg border shadow-sm" id="roomImage">
            </div>
        </div>

        <!-- Tr·∫°ng th√°i -->
        <div class="col-span-2">
            <label class="block font-semibold mb-1 text-gray-700">Tr·∫°ng th√°i</label>
            <select id="status" name="status"
                    class="w-full border rounded p-2 focus:ring focus:ring-blue-300">
                <option value="available"
                        th:selected="${#strings.equalsIgnoreCase(room.status, 'available')}">Available</option>
                <option value="deleted"
                        th:selected="${#strings.equalsIgnoreCase(room.status, 'deleted')}">Deleted</option>

            </select>
        </div>


        <!-- N√∫t h√†nh ƒë·ªông -->
        <div class="col-span-2 flex justify-between mt-6">
            <a href="/dashboard/room"
               class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg shadow-md transition">‚¨Ö H·ªßy</a>
            <button type="button"
                    th:onclick="'updateRoom(' + ${room.roomId} + ')'"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md transition">
                üíæ C·∫≠p nh·∫≠t
            </button>
        </div>
    </div>
</div>

<script>
    // Kh·ªüi t·∫°o CKEditor 5
    let editorInstance;
    ClassicEditor
        .create(document.querySelector('#description'))
        .then(editor => {
            editorInstance = editor;
        })
        .catch(error => {
            console.error('L·ªói CKEditor:', error);
        });

    // C·∫≠p nh·∫≠t ph√≤ng (PUT)
    function updateRoom(roomId) {
        const roomData = {
            roomName: document.getElementById('roomName').value,
            type: document.getElementById('roomType').value,
            price: document.getElementById('price').value,
            description: editorInstance.getData(), // L·∫•y HTML t·ª´ CKEditor
            img: document.getElementById('img').value,
            status: document.getElementById('status').value
        };

        fetch(`/api/rooms/${roomId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(roomData)
        })
        .then(response => {
            if (response.ok) {
                alert('‚úÖ C·∫≠p nh·∫≠t ph√≤ng th√†nh c√¥ng!');
                window.location.href = '/dashboard/room';
            } else {
                alert('‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
            }
        })
        .catch(err => {
            console.error('L·ªói:', err);
            alert('‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t.');
        });
    }
</script>

</body>
</html>
