<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ch·ªânh s·ª≠a ph√≤ng</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <style>
        /* Hi·ªáu ·ª©ng m∆∞·ª£t cho ph·∫ßn xem tr∆∞·ªõc */
        #descriptionPreview {
            transition: all 0.3s ease-in-out;
            animation: fadeIn 0.4s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold mb-6 text-center">Ch·ªânh s·ª≠a ph√≤ng</h1>

    <!-- Form -->
    <div class="grid grid-cols-2 gap-4" th:object="${room}">

        <!-- T√™n ph√≤ng -->
        <div class="col-span-2">
            <label class="block font-medium mb-1">T√™n ph√≤ng</label>
            <input id="roomName" type="text" name="roomName" th:value="*{roomName}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- Lo·∫°i ph√≤ng -->
        <div>
            <label class="block font-medium mb-1">Lo·∫°i ph√≤ng</label>
            <input id="roomType" type="text" name="type" th:value="*{type}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- Gi√° -->
        <div>
            <label class="block font-medium mb-1">Gi√° (VNƒê)</label>
            <input id="price" type="number" step="0.01" name="price" th:value="*{price}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300" required>
        </div>

        <!-- M√¥ t·∫£ (c√≥ preview HTML) -->
        <div class="col-span-2">
            <label class="block font-medium mb-1">M√¥ t·∫£ (c√≥ th·ªÉ nh·∫≠p HTML)</label>
            <textarea id="description" name="description" rows="4" th:text="*{description}"
                      class="w-full border rounded p-2 focus:ring focus:ring-blue-300"
                      oninput="updatePreview()"></textarea>

            <!-- Ph·∫ßn xem tr∆∞·ªõc -->
            <div class="mt-3 p-3 border rounded bg-gray-50">
                <h3 class="font-semibold mb-2">üîç Xem tr∆∞·ªõc m√¥ t·∫£:</h3>
                <div id="descriptionPreview" class="p-3 bg-white border rounded shadow-sm min-h-[80px]">
                    <span class="text-gray-400">N·ªôi dung m√¥ t·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</span>
                </div>
            </div>
        </div>

        <!-- ·∫¢nh -->
        <div class="col-span-2">
            <label class="block font-medium mb-1">·∫¢nh (URL)</label>
            <input id="img" type="text" name="img" th:value="*{img}"
                   class="w-full border rounded p-2 focus:ring focus:ring-blue-300">
            <div class="mt-2">
                <img th:src="*{img}" alt="Room Image Preview"
                     class="w-40 h-28 object-cover rounded border">
            </div>
        </div>

        <!-- Tr·∫°ng th√°i -->
        <div class="col-span-2">
            <label class="block font-medium mb-1">Tr·∫°ng th√°i</label>
            <select id="status" name="status" th:value="*{status}"
                    class="w-full border rounded p-2 focus:ring focus:ring-blue-300">
                <option value="available">Available</option>
                <option value="deleted">Deleted</option>
            </select>
        </div>

        <!-- N√∫t c·∫≠p nh·∫≠t -->
        <div class="col-span-2 flex justify-between mt-4">
            <a href="/dashboard/room"
               class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded">H·ªßy</a>
            <button type="button"
                    th:onclick="'updateRoom(' + ${room.roomId} + ')'"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                C·∫≠p nh·∫≠t
            </button>
        </div>
    </div>
</div>

<script>
    // C·∫≠p nh·∫≠t preview khi ng∆∞·ªùi d√πng nh·∫≠p m√¥ t·∫£
    function updatePreview() {
        const description = document.getElementById("description").value;
        const preview = document.getElementById("descriptionPreview");
        preview.innerHTML = description.trim() || '<span class="text-gray-400">N·ªôi dung m√¥ t·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</span>';
    }

    // Hi·ªÉn th·ªã preview ban ƒë·∫ßu khi load trang
    document.addEventListener("DOMContentLoaded", updatePreview);

    // G·ª≠i PUT request c·∫≠p nh·∫≠t ph√≤ng
    function updateRoom(roomId) {
        const roomData = {
            roomName: document.querySelector('[name="roomName"]').value,
            type: document.querySelector('[name="type"]').value,
            price: document.querySelector('[name="price"]').value,
            description: document.querySelector('[name="description"]').value,
            img: document.querySelector('[name="img"]').value,
            status: document.querySelector('[name="status"]').value
        };

        fetch(`/api/rooms/${roomId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(roomData)
        })
        .then(response => {
            if (response.ok) {
                alert('‚úÖ C·∫≠p nh·∫≠t ph√≤ng th√†nh c√¥ng!');
                window.location.href = '/dashboard/room';
            } else {
                alert('‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
            }
        })
        .catch(err => {
            console.error('L·ªói:', err);
            alert('‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t.');
        });
    }
</script>

</body>
</html>
